<div class="pt-8 pb-8 flex flex-col gap-10">
  <app-hero-section [description]="heroDescription" [title]="heroTitle"/>
  <section class="flex flex-col gap-8">
    <div class="flex items-center justify-between">
      <div class="flex flex-col sm:flex-row items-center gap-8 w-full h-full">
        <div class="relative flex items-center min-w-1/4">
          <fa-icon [icon]="faMagnifyingGlass" class="absolute left-4 text-gray-400"/>
          <input
            [formControl]="searchControl"
            class="w-full pt-2 pb-2 pr-2 pl-12 placeholder:text-gray-400 border rounded-4xl border-gray-300 shadow-sm focus:outline-none focus:border-gray-400"
            id="eventSearch"
            placeholder="Search events..."
            type="text"
          />
        </div>
        <div class="flex gap-2">
          <button
            (click)="selectFilter(Filter.AllEvents)"
            [class.active]="selectedFilter() === Filter.AllEvents"
            class="relative overflow-hidden px-3 cursor-pointer before:content-['']
                    before:absolute before:bottom-0 before:left-1/2 before:w-0 before:h-px before:bg-gray-300 before:transition-all before:duration-300
                    hover:not-[&.active]:before:w-11/12 hover:not-[&.active]:before:left-[5%]
                    [&.active]:before:w-11/12 [&.active]:before:left-[5%] [&.active]:font-semibold [&.active]:before:bg-black"
          >
            All Events
          </button>
          <button
            (click)="selectFilter(Filter.Today)"
            [class.active]="selectedFilter() === Filter.Today"
            class="relative overflow-hidden px-3 cursor-pointer before:content-['']
                    before:absolute before:bottom-0 before:left-1/2 before:w-0 before:h-px before:bg-gray-300 before:transition-all before:duration-300
                    hover:not-[&.active]:before:w-11/12 hover:not-[&.active]:before:left-[5%]
                    [&.active]:before:w-11/12 [&.active]:before:left-[5%] [&.active]:font-semibold [&.active]:before:bg-black"
          >
            Today
          </button>
          <button
            (click)="selectFilter(Filter.Weekend)"
            [class.active]="selectedFilter() === Filter.Weekend"
            class="relative overflow-hidden px-3 cursor-pointer before:content-['']
                    before:absolute before:bottom-0 before:left-1/2 before:w-0 before:h-px before:bg-gray-300 before:transition-all before:duration-300
                    hover:not-[&.active]:before:w-11/12 hover:not-[&.active]:before:left-[5%]
                    [&.active]:before:w-11/12 [&.active]:before:left-[5%] [&.active]:font-semibold [&.active]:before:bg-black"
          >
            Weekend
          </button>
        </div>
      </div>
      <app-view-toggle [(value)]="viewMode" [options]="viewOptions" class="hidden md:block"/>
    </div>
    @let tags = tags$ | async;
    @if (tags) {
      <p-multi-select [formControl]="tagsFilterControl" [options]="tags" class="sm:w-xs md:w-sm lg:w-md"
                      optionLabel="name"
                      placeholder="Select tags"/>
    }
  </section>
  <section [class.flex-col]="viewMode() === EventListingView.List"
           [class.flex]="viewMode() === EventListingView.List"
           [class.grid]="viewMode() === EventListingView.Grid"
           [class.lg:grid-cols-3]="viewMode() === EventListingView.Grid"
           [class.max-w-5xl]="viewMode() === EventListingView.List"
           [class.md:grid-cols-2]="viewMode() === EventListingView.Grid"
           [class.self-center]="viewMode() === EventListingView.List"
           [class]="{ 'md:min-w-3/4': viewMode() === EventListingView.List }"
           class="gap-6 w-full">
    @let eventsPagedList = events$ | async;
    @if (eventsPagedList) {
      @for (event of eventsPagedList.items; track event.id) {
        <app-event-listing-card (joinClick)="onJoinEventClick($event)" [event]="event" [viewMode]="viewMode()"/>
      }

      @if (eventsPagedList.totalCount === 0) {
        <p class="text-center col-span-4">No events found.</p>
      }
    } @else {
      <div class="flex justify-center items-center col-span-4">
        <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      </div>
    }
  </section>
</div>

@if (joinEventDialogIsOpen()) {
  <app-join-event-dialog (closeDialog)="closeJoinEventDialog()" (joinEventSubmit)="onJoinEventFormSubmit()"/>
}
